# python
import time
from typing import Optional

# Maps corpse_agent_id -> timestamp when it was exploited
_exploited_corpses: dict[int, float] = {}

# Window in seconds to consider a corpse as "recently exploited"
_WINDOW_SECONDS = 5.0


def record_corpse_exploited(corpse_id: int) -> None:
    """Record that a corpse was exploited (e.g., by Putrid Explosion) now."""
    if corpse_id is None:
        return
    now = time.time()
    _exploited_corpses[int(corpse_id)] = now
    # Cleanup old entries
    _cleanup_old(now)


def was_corpse_exploited_recently(corpse_id: Optional[int], window_seconds: float = _WINDOW_SECONDS) -> bool:
    """Return True if corpse was exploited within the last `window_seconds`."""
    if corpse_id is None:
        return False
    ts = _exploited_corpses.get(int(corpse_id))
    if ts is None:
        return False
    return (time.time() - ts) < float(window_seconds)


def _cleanup_old(now: float, threshold: float = _WINDOW_SECONDS) -> None:
    """Remove entries older than threshold seconds."""
    to_remove = [cid for cid, ts in _exploited_corpses.items() if (now - ts) >= threshold]
    for cid in to_remove:
        del _exploited_corpses[cid]

